<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:of="http://omnifaces.org/functions">

<f:view locale="#{localeBean.locale}">
    <f:metadata>
        <f:viewParam name="redirect" value="#{loginBean.redirectUrl}" />
        <f:event type="preRenderView" listener="#{loginBean.init}" />
    </f:metadata>
    
    <h:head>
        <title>#{msg['login.title']}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <!-- CSS Resources -->
        <h:outputStylesheet name="css/login.css" />
        <h:outputStylesheet library="primefaces" name="theme.css" />
        <h:outputStylesheet name="css/font-awesome.min.css" />
        
        <!-- JS Resources -->
        <h:outputScript name="js/login.js" target="head" />
        <h:outputScript library="primefaces" name="jquery/jquery.js" target="head" />
        
        <style type="text/css">
            .login-container {
                height: 100vh;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            .login-card {
                border-radius: 15px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            }
            .login-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-top-left-radius: 15px;
                border-top-right-radius: 15px;
                padding: 30px;
            }
            .login-body {
                padding: 40px;
                background-color: #ffffff;
                border-bottom-left-radius: 15px;
                border-bottom-right-radius: 15px;
            }
            .input-group-prepend {
                background-color: #f8f9fa;
                border-right: none;
            }
            .form-control {
                border-left: none;
            }
            .btn-login {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
                transition: all 0.3s ease;
            }
            .btn-login:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            }
        </style>
    </h:head>
    
    <h:body>
        <div class="login-container d-flex align-items-center justify-content-center">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6 col-lg-4">
                        <div class="login-card">
                            <div class="login-header text-center text-white">
                                <h2 class="mb-3">
                                    <i class="fas fa-lock mr-2"></i>#{msg['login.system.title']}
                                </h2>
                                <p class="mb-0">#{msg['login.system.subtitle']}</p>
                            </div>
                            
                            <div class="login-body">
                                <h:form id="loginForm" prependId="false">
                                    <!-- Messages -->
                                    <p:messages id="messages" showDetail="true" 
                                                closable="true" autoUpdate="true" />
                                    
                                    <!-- CSRF Token -->
                                    <input type="hidden" name="#{csrf.token.name}" 
                                           value="#{csrf.token}" />
                                    
                                    <!-- Username Field -->
                                    <div class="form-group mb-4">
                                        <label for="username" class="form-label">
                                            <i class="fas fa-user mr-2"></i>#{msg['login.username']}
                                        </label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="fas fa-user"></i>
                                                </span>
                                            </div>
                                            <h:inputText id="username" 
                                                         value="#{loginBean.username}"
                                                         styleClass="form-control"
                                                         placeholder="#{msg['login.username.placeholder']}"
                                                         required="true"
                                                         requiredMessage="#{msg['login.username.required']}"
                                                         autocomplete="off">
                                                <f:ajax event="blur" render="username_message" />
                                            </h:inputText>
                                        </div>
                                        <h:message for="username" id="username_message" 
                                                   styleClass="text-danger small" />
                                    </div>
                                    
                                    <!-- Password Field -->
                                    <div class="form-group mb-4">
                                        <label for="password" class="form-label">
                                            <i class="fas fa-key mr-2"></i>#{msg['login.password']}
                                        </label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="fas fa-key"></i>
                                                </span>
                                            </div>
                                            <h:inputSecret id="password" 
                                                           value="#{loginBean.password}"
                                                           styleClass="form-control"
                                                           placeholder="#{msg['login.password.placeholder']}"
                                                           required="true"
                                                           requiredMessage="#{msg['login.password.required']}"
                                                           autocomplete="off">
                                                <f:ajax event="blur" render="password_message" />
                                            </h:inputSecret>
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary" 
                                                        type="button" 
                                                        onclick="togglePassword()">
                                                    <i class="fas fa-eye"></i>
                                                    <h:inputText id="email"
             value="#{loginBean.email}"
             required="true"
             label="Email">
    <f:validator validatorId="emailValidator"/>
</h:inputText>
<h:message for="email"/>

                                                </button>
                                            </div>
                                        </div>
                                        <h:message for="password" id="password_message" 
                                                   styleClass="text-danger small" />
                                    </div>
                                    
                                    <!-- Remember Me -->
                                    <div class="form-group form-check mb-4">
                                        <h:selectBooleanCheckbox id="rememberMe"
                                                                 value="#{loginBean.rememberMe}"
                                                                 styleClass="form-check-input" />
                                        <label class="form-check-label" for="rememberMe">
                                            #{msg['login.remember']}
                                        </label>
                                    </div>
                                    
                                    <!-- Login Button -->
                                    <div class="form-group mb-3">
                                        <h:commandButton id="loginBtn"
                                                         value="#{msg['login.button']}"
                                                         action="#{loginBean.login}"
                                                         styleClass="btn btn-login btn-block py-3"
                                                         style="font-weight: bold;">
                                            <f:ajax execute="@form" render="messages" 
                                                    onevent="handleLoginAjax" />
                                        </h:commandButton>
                                    </div>
                                    
                                    <!-- Forgot Password -->
                                    <div class="text-center mb-3">
                                        <h:link outcome="/forgot-password" 
                                                 value="#{msg['login.forgot.password']}"
                                                 styleClass="text-decoration-none" />
                                    </div>
                                    
                                    <!-- Register Link -->
                                    <div class="text-center">
                                        <span class="text-muted">#{msg['login.no.account']}</span>
                                        <h:link outcome="/register" 
                                                 value="#{msg['login.register']}"
                                                 styleClass="font-weight-bold ml-1" />
                                    </div>
                                    
                                    <!-- Social Login (Optional) -->
                                    <div class="mt-4 pt-3 border-top text-center">
                                        <p class="text-muted mb-3">#{msg['login.social.title']}</p>
                                        <div class="d-flex justify-content-center">
                                            <button class="btn btn-outline-primary mx-2">
                                                <i class="fab fa-google"></i>
                                            </button>
                                            <button class="btn btn-outline-info mx-2">
                                                <i class="fab fa-linkedin"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary mx-2">
                                                <i class="fab fa-github"></i>
                                            </button>
                                        </div>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                        
                        <!-- Security Info -->
                        <div class="mt-4 text-center text-white">
                            <p class="small">
                                <i class="fas fa-shield-alt mr-1"></i>
                                #{msg['login.security.info']}
                            </p>
                            <p class="small">
                                <i class="fas fa-info-circle mr-1"></i>
                                v#{app.version} | 
                                <h:outputText value=" (#{loginBean.environment})" rendered="#{loginBean.showEnv}" />
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- JavaScript for password toggle -->
        <script type="text/javascript">
            function togglePassword() {
                var passwordField = document.getElementById('password');
                var toggleIcon = document.querySelector('#password + .input-group-append i');
                
                if (passwordField.type === 'password') {
                    passwordField.type = 'text';
                    toggleIcon.className = 'fas fa-eye-slash';
                } else {
                    passwordField.type = 'password';
                    toggleIcon.className = 'fas fa-eye';
                }
            }
            
            function handleLoginAjax(data) {
                if (data.status === 'success') {
                    // Optional: Add any post-login UI effects
                }
            }
            
            // Auto-focus username field on page load
            $(document).ready(function() {
                $('#username').focus();
                
                // Handle Enter key press
                $('#loginForm input').keypress(function(e) {
                    if (e.which === 13) {
                        $('#loginBtn').click();
                        return false;
                    }
                });
            });
        </script>
    </h:body>
</f:view>
</html>
